<!DOCTYPE HTML>
<html lang="fr">
<head>
	<title>HHVM et "Hack", prenez 2 versions d'avance sur PHP</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=792, user-scalable=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<link rel="stylesheet" href="shower/themes/ribbon/styles/screen.css">
	<link rel="stylesheet" href="styles/prism.css" />
	<link rel="stylesheet" href="styles/custom.css">
</head>
<body class="list">
	<header class="caption">
		<h1>HHVM et "Hack", prenez 2 versions d'avance sur PHP</h1>
		<p>PHP Tour Lyon - Benjamin Clay && Mathieu Darse - Juin 2014</p>
	</header>

	<section class="slide cover" id="coverpage"><div>
		<div class="covertitle">
			<h2>HHVM et "Hack", prenez 2 versions d'avance sur PHP</h2>
			<p>PHP Tour Lyon - Benjamin Clay && Mathieu Darse - <span class="date">Juin 2014</span></p>
		</div>
	</div></section>

	<section class="slide"><div>
		<h2>Coucou, je suis Benjamin Clay</h2>
		<ul style="margin-bottom: 25px">
			<li>Expert Web et mobile @ <a href="http://jolicode.com"><img src="pictures/logo.svg" style="height:1em; vertical-align: text-bottom;"></a>, et éleveur de licornes.</li>
		</ul>
		<p><img src="pictures/twitter.png" style="width: 20px"> <a href="https://twitter.com/ternel">@ternel</a></p>
		<h2>Coucou, je suis Mathieu</h2>
		<ul style="margin-bottom: 25px">
			<li>Web- expert at <a href="http://jolicode.com">JoliCode</a></li>
		</ul>
		<p><img src="pictures/twitter.png" style="width: 20px"> <a href="https://twitter.com/mdarse">@mdarse</a></p>
	</div></section>

	<section class="slide cover"><div>
		<img src="covers/jolicode-bg.jpg" alt="" />
	</div></section>

	<section class="slide"><div>
		<h2>Parlons de ... </h2>
		<img src="pictures/php-logo.jpeg" alt="" class="place" />
	</div></section>

	<section class="slide"><div>
		<h2>PHP a de bons côtés</h2>
		<ul>
			<li class="next">C'est facile</li>
			<li class="next">Rapide à apprendre</li>
			<li class="next">Disponible pratiquement partout, et souvent très facilement</li>
			<li class="next">Belles choses à faire avec ? :)</li>
		</ul>
		<img src="pictures/urkel.jpg" alt="" class="next"/>
	</div></section>

	<section class="slide"><div>
		<h2>Des points négatifs</h2>
		<ul>
			<li class="next">"Inconsistent haystack / needle"</li>
			<li class="next">PHP is a HTML file, with logic</li>
			<li class="next">No standards</li>
			<li class="next">Lack of Quality Packages</li>
			<li class="next">Misconception</li>
			<li class="next">You were doing it wrong</li>
			<li class="next">Elitism</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Bref...</h2>
		<img src="pictures/php-logo.jpeg" width="50%" alt="" class="middle" /><span class="biggest">&nbsp;==&nbsp;</span><img src="pictures/popo.gif" alt="" class="middle" style="margin-bottom: 35px" />
	</div></section>

	<section class="slide"><div>
		<img src="pictures/ie3.jpg" width="50%" /><img src="pictures/ie55.jpg" width="50%" />
		<h2 class="next">Vous vous souvenez d'Internet Explorer ?</h2>
	</div></section>

	<section class="slide"><div>
		<img src="pictures/php-logo.jpeg" alt="" width="45%" class="middle" /><span class="biggest">&nbsp;==&nbsp;</span><img src="pictures/ie.jpg" width="35%" alt="" class="middle" style="margin-bottom: 35px" />
	</div></section>

	<section class="slide"><div>
		<p>Parfait pour un projet rapide, fait le soir dans une chambre d'étudiant.</p>
		<div class="next">
			<img src="covers/fb-etudiant.jpg" alt="" />
			<div><h2 style="display: inline;">TheFacebook.com</h2> (avec Spiderman <img src="pictures/spiderman.jpg" />)</div>
		</div>
	</div></section>

	<section class="slide cover"><div>
		<h2>Facebook</h2>
		<img src="covers/facebook.jpg" alt="" />
	</div></section>

	<section class="slide tall"><div>
		<li>Faites un site qui permet de glander au bureau... et :</li>
		<img src="pictures/fb-dailyuse.png" width="90%" />
	</div></section>

	<section class="slide"><div>
		<h2>Les problèmes commencent...</h2>
		<ul>
			<li><strong>400 milliards de pages vues par mois</strong> propulsées par PHP, soit 400 Facebook Unit</li>
			<li>== Problèmes de performances, et scalabilité</li>
		</ul>
		<div class="next"><blockquote>Ils aûraient du tout réécrire en utilisant un vrai langage.</blockquote> Marcel Patulacci</div>
	</div></section>

	<section class="slide"><div>
		<ul>
			<li><strong>20 millions de lignes de PHP</strong>, soit 0,02 Facebook Unit</li>
		</ul>
		<div class="next"><blockquote>Ils aûraient du tout réécrire en utilisant un vrai langage, mais plus tôt.</blockquote> Marcel Patulacci</div>
	</div></section>

	<section class="slide"><div>
		<blockquote>Languages don't scale. Architecture does.</blockquote>
		<p>Abraham Lincoln</p>
	</div></section>

	<section class="slide"><div>
		<h2>Solution possible :<br />Réécrire sous forme d'extension PHP</h2>
		<ul>
			<li><img src="pictures/yes.png" class="check" alt="" /> Réécriture pas à pas</li>
			<li><img src="pictures/no.png" class="check" alt="" /> Beaucoup moins de développeurs disponibles</li>
			<li><img src="pictures/no.png" class="check" alt="" /> Obligation d'apprendre l'API Zend</li>
		</ul>
	</div></section>

	<section class="slide cover"><div>
		<h2>Facebook Research Center</h2>
		<img src="covers/fbresearch.jpg" alt="" />
	</div></section>

	<section class="slide"><div>
		<h2>HipHop for PHP</h2>
		<img src="pictures/fb-hiphop.jpg" alt="" style="float: right;" />
		<ul>
			<li>À partir de 2008, Open-Source en 2010</li>
			<li>Compilateur, ou plutôt Source Code Transformer</li>
			<li>PHP -> C++, puis compilation g++</li>
			<li>Pleins d'alternatives possibles :
				<ul>
					<li>Quercus: PHP -> Java</li>
					<li>PHC: PHP -> C</li>
					<li>Phalanger : PHP -> .Net <img src="pictures/trollface.png" style="vertical-align: middle;" /></li>
				</ul>
			</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>HipHop for PHP</h2>
		<ul>
			<li>90% du site était en HipHop</li>
			<li>Jusqu'a 50% de CPU Usage en moins</li>
			<li>Déploiement d'un exécutable</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<img src="pictures/fb-hiphop-schema.png" />
	</div></section>

	<section class="slide"><div>
		<h2>HipHop for PHP</h2>
		<ul>
			<li>Fuck YEAH, ça à l'air cool</li>
			<li>Mais bof en fait</li>
			<li>PHP 5.2, et pas complètement</li>
			<li>ie. non utilisable</li>
		</ul>
	</div></section>

	<section class="slide cover"><div>
		<h2>HHVM</h2>
		<img src="covers/fb-servers.jpg" alt="" />
	</div></section>

	<section class="slide"><div>
		<h2>HipHop Virtual Machine</h2>
		<ul>
			<li>Création par une équipe de 3 personnes</li>
			<li>En quelques mois, meilleurs perfs que HipHop</li>
			<li>Et maintenant, encore plus performant !</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>HHVM</h2>
		<ul>
			<li>CLI + FastCGI</li>
			<li>64bits</li>
			<li>Code machine caché en sqlite</li>
			<li>JIT</li>
			<li>Explication JIT</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>HHVM</h2>
		<ul>
			<li>Release Open Source !</li>
			<li>Calendrier de releases : toutes les 2 semaines en interne / toutes les 8 semaines / nightly</li>
			<li>Tente d'être compatible avec un maximum de projets</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<ul>
			<li>Compatibilité : Laravel, Twig, Drupal, ...</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<ul>
			<li>Extensions dynamiques - comme PHP</li>
			<li>Peuvent être écrite en PHP, Hack ou C++, et même en combinant des langages</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<ul>
			<li>Linux: repo Debian, Ubuntu, Fedora...</li>
			<li>MacOSX : Homebrew</li>
			<li>Windows: AHAH.</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<li>Benchmarks</li>
		<img src="pictures/benchmarks.jpg" />
		<li>Premières requests servent à chauffer la bête ! - http://stackoverflow.com/questions/17898783/hhvm-poor-performance</li>
	</div></section>

	<section class="slide cover"><div>
		<h2>Les alternatives</h2>
	</div></section>

	<section class="slide"><div>
		<li>Zephir</li>
		<li>PHP NG</li>
	</div></section>

	<section class="slide cover"><div>
		<h2>Hack</h2>
	</div></section>

	<section class="slide"><div>
		<ul>
		<li>Il suffit de chercher "HACK Facebook" sur un moteur de recherche<br />
			<img src="pictures/hack-fb-1.png" /> <img src="pictures/hack-fb-2.png" />

		</li>
		<li class="next">Comme pour le Go de Google, avec <code>#golang</code>, utilisez <code>#hacklang</code> ;)</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<ul>
			<li>Dispo dans HHVM</li>
			<li>Écrit en OCaml</li>
			<li>Fonctionne très bien en parallèle de PHP</li>
			<li>Modes :
			<ul>
				<li>Partial</li>
				<li>Strict : tout doit être typé, pas d'appel à du code non-hack</li>
				<li>Decl : code non-strict appelable</li>
				<li>Unsafe : pas de type-checking</li>
			</ul></li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>XHP</h2>
		<ul>
			<li>En fait Facebook a commencé à changer PHP bien avant !</li>
			<li>XHP !</li>
			<li>Extension PHP qui augmente la syntaxe du langage</li>
			<li>Exemple : </li>
			<code>&lt;?php<br/>
			$href = 'http://www.facebook.com';<br/>
			echo &lt;a href={$href}&gt;Facebook&lt;/a&gt;;</code>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Fonctionnalités</h2>
		<ul>
			<li>No templating - <code>?></code> non disponible</li>
			<li>Type annotations</li>
			<li>Generics</li>
			<li>Collections</li>
			<li>Fonctions asynchrones</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Rappel !</h2>
		<p>PHP est dynamiquement typé !</p>
		<ul>
			<li><img src="pictures/yes.png" class="check" alt="" /> Flexibilité</li>
			<li><img src="pictures/no.png" class="check" alt="" /> Erreurs possibles</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Type hinting</h2>
		<p>Return type hinting</p>
		<p>Propriétés de classe</p>
	</div></section>

	<section class="slide"><div>
		<h2>Type hinting</h2>
		<li>Daemon type-checker : sur le poste du dev, programme qui watch le code source</li>
		<li>A la modification d'un fichier, il y a comparaison avec l'ancien fichier, et re-calcule si besoin</li>
		<li>method by method === rapidité !</li>
		<li>Configuration via .hhconfig</li>
		<li>hh_client pour voir l'état</li>
	</div></section>

	<section class="slide"><div>
		<h2>Type hinting</h2>
		<li>Type de retour des fonctions / méthodes</li>
		<li>Type nullable: <code>?type</code></li>
		<li>Types disponibles: <code>int</code>, <code>float</code>, <code>string</code>, <code>bool</code>, <code>MyClass</code>, <code>Vector&lt;type&gt;</code>, <code>this</code>, <code>mixed</code>, <code>void</code></li>
		<li><code>?int</code>, <code>array</code>, <code>array&lt;int&gt;</code>, <code>array&lt;MyClass&gt;</code>, <code>array&lt;int, MyClass&gt;</code></li>
	</div></section>

	<section class="slide"><div>
		<h2>Exemple : </h2>
		<code>&lt;?hh<br/></code>
	</div></section>

	<section class="slide"><div>
		<p>Pas de <code>?></code></p>
		<p>On ne mélange pas HTML et Hack.</p>
		<p>hackificator // hh_server ༼ つ ◕_◕ ༽つ</p>
		<p>hh_server: 1/2 journée + 10Go de RAM - 10 millions de lignes de codes</p>
	</div></section>

	<section class="slide"><div>
		<h2>Generics</h2>
		<li>Type de classe variable</li>
		<li>Analyse statique du code</li>
		<li><code>array&lt;int&gt;</code> != <code>array&lt;string&gt;</code></li>
	</div></section>

	<section class="slide"><div>
		<h2>Collections</h2>
		<li>Vector : Liste ordonnée de valeur du même type</li>
		<code>$vector = Vector{'pony', 'unicorn'};</code>
		<li>Map : Valeurs de même type, clés = string ou int</li>
		<code>$map = Map{'pony' => 5, 'unicorn' = 42};</code>
		<li>Set : Liste d'int ou string</li>
		<code>$set = Set{'pony', 'unicorn'};</code>
		<li>Pair : Pair de valuer de n'importe quel type, immutable</li>
		<code>$pair = Pair{'jolicode', 42};</code>
	</div></section>

	<section class="slide"><div>
		<h2>Lambda</h2>
		<ul>
			<li>Binding de variable automatique</li>
			<li>Syntaxe plus courte</li>
			<li><code>==></code></li>
		</ul>
	</div></section>>

	<section class="slide"><div>
		<h2>Async</h2>
		<ul>
			<li>Paralléliser les tâches : cuire des pâtes, couper les tomates, ...</li>
			<li><code>async</code> et <code>await</code> keywords</li>
			<li>Early stage : use at your own risk!</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<li>Exemple</li>
		<pre><code class="language-php">&lt;?hh

function vector_add1(Vector&lt;int&gt; $v): Vector&lt;int&gt; {
  // Example of lambda expressions.
  return $v->map($x ==> $x + 1);
}
</code></pre>
		<li>Tuple</li>
	</div></section>

	<section class="slide"><div>
		<h2>Non supportés dans Hack</h2>
		<p><code>goto</code>, <code>if ... endif;</code>, <code>break N</code>, <code>continue N</code>, variables globales, ...</p>
		<li>http://docs.hhvm.com/manual/en/hack.unsupported.php</li>
	</div></section>

	<section class="slide"><div>
		<h2>Faut-il l'utiliser ?</h2>
		<ul>
			<li>Hack a été créé par <img src="pictures/facebook.jpg" style="height:1.5em; vertical-align: text-bottom;" alt="Facebook"><span class="next"> pour <img src="pictures/facebook.jpg" style="height:1.5em; vertical-align: text-bottom;" alt="Facebook"></span></li>
			<li>HHVM reste un runtime PHP ! Hack vient en plus.</li>
		</ul>
	</div></section>

	<section class="slide"><div>
		<h2>Hack va déchainer les développeurs ?</h2>
		<ul class="next">
			<li>https://wiki.php.net/rfc/returntypehinting</li>
			<li>https://wiki.php.net/rfc/constructor-promotion</li>
			<li>https://wiki.php.net/rfc/consistent-names</li>
			<li>http://www.php-cpp.com/</li>
		</ul>
	</div></section>

	<section class="slide cover" id="end"><div>
		<h2>
			Benjamin et Mathieu<br />
			<a href="http://jolicode.com">http://jolicode.com</a>
		</h2>
	</div></section>

	<div class="progress"><div></div></div>
	<script src="shower/shower.min.js"></script>
	<script src="styles/prism.js"></script>
	<script src="styles/jquery-2.1.1.min.js"></script>
	<script src="styles/progress.js"></script>
</body>
</html>
